---

- name: Copy the keys to the strongswan directory
  copy:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    owner: "{{ item.owner }}"
    group: "{{ item.group }}"
    mode: "{{ item.mode }}"
  with_items:
    - src: "{{ newtroy_server_configs }}/pki/cacert.pem"
      dest: "{{ config_prefix|default('/') }}etc/ipsec.d/cacerts/ca.crt"
      owner: strongswan
      group: "{{ root_group|default('root') }}"
      mode: "0600"
    - src: "{{ newtroy_server_configs }}/pki/certs/{{ newtroy_server_cert_common_name }}.crt"
      dest: "{{ config_prefix|default('/') }}etc/ipsec.d/certs/{{ newtroy_server_cert_common_name }}.crt"
      owner: strongswan
      group: "{{ root_group|default('root') }}"
      mode: "0600"
    - src: "{{ newtroy_server_configs }}/pki/private/{{ newtroy_server_cert_common_name }}.key"
      dest: "{{ config_prefix|default('/') }}etc/ipsec.d/private/{{ newtroy_server_cert_common_name }}.key"
      owner: strongswan
      group: "{{ root_group|default('root') }}"
      mode: "0600"
  notify:
    - restart strongswan
